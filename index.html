<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>縫魔 妖斗 | Official</title>
  <style>
    :root{
      --bg: url("bg.jpg");
      --panel: rgba(0,0,0,.45);
      --line: rgba(255,255,255,.10);
      --text: rgba(255,255,255,.92);
      --shadow: rgba(0,0,0,.55);
      --smoke-a: .85;
      --smoke-b: .55;
      --smoke-c: .35;
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; }
    body{
      background:#05040a;
      color:var(--text);
      font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
      overflow-x:hidden;
    }

    /* ===== 上部ナビ ===== */
    .nav{
      position:fixed; top:0; left:0; right:0;
      display:flex; justify-content:space-between; align-items:center;
      padding:14px 18px; z-index:60;
      background: linear-gradient(to bottom, rgba(0,0,0,.60), rgba(0,0,0,0));
    }
    .brand{
      font-weight:800; letter-spacing:.10em;
      text-shadow: 0 8px 22px var(--shadow);
      user-select:none; display:flex; gap:10px; align-items:center;
    }
    .brand small{ opacity:.7; font-weight:600; letter-spacing:.08em; }
    .menu a{
      color:var(--text); text-decoration:none;
      margin-left:14px; opacity:.86; letter-spacing:.06em;
    }
    .menu a:hover{ opacity:1; }

    /* ===== 背景レイヤー ===== */
    .stage{ position:relative; min-height:100vh; }

    .bg{
      position:fixed; inset:-3%;
      background-image: var(--bg);
      background-size: cover; background-position:center;
      filter: saturate(1.05) contrast(1.05);
      transform: translate3d(0,0,0) scale(1.03);
      will-change: transform;
      z-index:-6;
    }

    .vignette{
      position:fixed; inset:0;
      background: radial-gradient(80% 60% at 50% 40%, rgba(0,0,0,.15), rgba(0,0,0,.82));
      z-index:-2; pointer-events:none;
    }

    .chains{
      position:fixed; inset:-6%;
      background-image: var(--bg);
      background-size: cover; background-position:center;
      filter: brightness(.85) contrast(1.15);
      mix-blend-mode:multiply;
      opacity:.58;
      transform: translate3d(0,0,0) scale(1.08);
      animation: chainSway 8s ease-in-out infinite;
      will-change: transform;
      z-index:-5;

      -webkit-mask-image:
        radial-gradient(120% 70% at 50% 10%, rgba(0,0,0,1), rgba(0,0,0,0) 70%),
        radial-gradient(70% 120% at 10% 50%, rgba(0,0,0,1), rgba(0,0,0,0) 70%),
        radial-gradient(70% 120% at 90% 50%, rgba(0,0,0,1), rgba(0,0,0,0) 70%);
      mask-image:
        radial-gradient(120% 70% at 50% 10%, rgba(0,0,0,1), rgba(0,0,0,0) 70%),
        radial-gradient(70% 120% at 10% 50%, rgba(0,0,0,1), rgba(0,0,0,0) 70%),
        radial-gradient(70% 120% at 90% 50%, rgba(0,0,0,1), rgba(0,0,0,0) 70%);
    }
    @keyframes chainSway{
      0%{ transform: translate3d(-0.6%,-0.2%,0) scale(1.08) rotate(-0.15deg); }
      50%{ transform: translate3d(0.6%,0.2%,0) scale(1.08) rotate(0.15deg); }
      100%{ transform: translate3d(-0.6%,-0.2%,0) scale(1.08) rotate(-0.15deg); }
    }

    .smoke{
      position:fixed; inset:-20%;
      background:
        radial-gradient(40% 30% at 20% 60%, rgba(200,120,255,.20), rgba(0,0,0,0) 60%),
        radial-gradient(50% 40% at 70% 55%, rgba(255,80,200,.16), rgba(0,0,0,0) 62%),
        radial-gradient(55% 45% at 50% 70%, rgba(255,255,255,.10), rgba(0,0,0,0) 65%);
      filter: blur(18px);
      opacity: var(--smoke-a);
      animation: smokeDrift 14s linear infinite;
      mix-blend-mode: screen;
      pointer-events:none;
      z-index:-4;
    }
    .smoke.s2{ opacity: var(--smoke-b); filter: blur(26px); animation-duration:22s; animation-direction:reverse; }
    .smoke.s3{ opacity: var(--smoke-c); filter: blur(34px); animation-duration:30s; }
    @keyframes smokeDrift{
      0%{ transform: translate3d(-3%, 1%,0) scale(1.02); }
      50%{ transform: translate3d( 3%,-1%,0) scale(1.06); }
      100%{ transform: translate3d(-3%, 1%,0) scale(1.02); }
    }

    canvas#embers{
      position:fixed; inset:0;
      z-index:-3; pointer-events:none;
      mix-blend-mode: screen;
    }

    /* ===== 共通UI ===== */
    .btn{
      display:inline-block;
      padding:12px 18px;
      border-radius:999px;
      border:1px solid var(--line);
      color:var(--text);
      text-decoration:none;
      background: rgba(0,0,0,.35);
      letter-spacing:.08em;
      cursor:pointer;
      user-select:none;
    }
    .btn:hover{ background: rgba(0,0,0,.55); }
    .btn.ghost{ background: rgba(0,0,0,.20); }
    .btn.danger{ border-color: rgba(255,90,210,.22); }

    /* ===== ヒーロー ===== */
    .hero{
      min-height:100vh;
      display:grid; place-items:center;
      padding: min(8vw, 64px);
      text-align:center;
    }
    .hero-panel{
      width:min(980px, 92vw);
      padding: clamp(18px, 3vw, 34px);
      border-radius:18px;
      background: linear-gradient(to bottom, var(--panel), rgba(0,0,0,.18));
      backdrop-filter: blur(6px);
      border:1px solid var(--line);
      box-shadow: 0 10px 40px rgba(0,0,0,.45);
    }

    /* ネオン脈動 + たまにグリッチ */
    .logo-wrap{
      display:inline-block;
      position:relative;
      padding: 6px 8px;
      will-change: transform, filter;
      animation: glitchGate 6.5s infinite;
    }
    .logo{
      margin:0;
      font-size: clamp(38px, 6vw, 78px);
      letter-spacing:.10em;
      line-height:1.05;
      text-shadow: 0 12px 34px rgba(0,0,0,.6);
      animation: neonPulse 3.2s ease-in-out infinite;
    }
    @keyframes neonPulse{
      0%,100%{
        text-shadow:
          0 0 18px rgba(255,90,210,.25),
          0 0 36px rgba(200,120,255,.18),
          0 12px 34px rgba(0,0,0,.6);
      }
      50%{
        text-shadow:
          0 0 26px rgba(255,90,210,.40),
          0 0 60px rgba(200,120,255,.26),
          0 12px 34px rgba(0,0,0,.6);
      }
    }
    @keyframes glitchGate{
      0%, 88%, 100% { filter:none; transform:none; }
      90% { transform: translate3d(-1px, 0, 0) skewX(-2deg); }
      92% { transform: translate3d( 1px, 0, 0) skewX( 2deg); }
      94% { transform: translate3d( 0px, 0, 0) skewX( 0deg); }
    }
    .logo-wrap::before,
    .logo-wrap::after{
      content: attr(data-text);
      position:absolute;
      left:0; top:0;
      width:100%;
      opacity:0;
      pointer-events:none;
      mix-blend-mode: screen;
    }
    .logo-wrap::before{ color: rgba(255,80,200,.75); animation: glitchA 6.5s infinite; }
    .logo-wrap::after { color: rgba(200,120,255,.75); animation: glitchB 6.5s infinite; }
    @keyframes glitchA{
      0%,88%,100%{ opacity:0; transform:none; clip-path: inset(0 0 0 0); }
      90%{ opacity:.55; transform: translate(-2px,-1px); clip-path: inset(12% 0 68% 0); }
      92%{ opacity:.45; transform: translate( 2px, 0px); clip-path: inset(55% 0 30% 0); }
      94%{ opacity:0; transform:none; }
    }
    @keyframes glitchB{
      0%,88%,100%{ opacity:0; transform:none; clip-path: inset(0 0 0 0); }
      90%{ opacity:.55; transform: translate( 2px, 1px); clip-path: inset(0 0 78% 0); }
      92%{ opacity:.45; transform: translate(-2px, 0px); clip-path: inset(68% 0 10% 0); }
      94%{ opacity:0; transform:none; }
    }

    .stitchline{
      display:block;
      margin: 14px auto 18px;
      width: min(520px, 80%);
      height: 2px;
      background: linear-gradient(to right, rgba(255,255,255,0), rgba(255,180,255,.55), rgba(255,90,210,.55), rgba(255,255,255,0));
      position:relative;
      opacity:.65;
    }
    .stitchline::after{
      content:"";
      position:absolute;
      inset:-10px 0 -10px 0;
      background: repeating-linear-gradient(90deg, rgba(255,255,255,.35) 0 2px, rgba(255,255,255,0) 2px 10px);
      opacity:.35;
      mask-image: linear-gradient(to right, rgba(0,0,0,0), rgba(0,0,0,1), rgba(0,0,0,0));
    }
    .tag{ margin: 10px 0 18px; opacity:.88; letter-spacing:.06em; }

    /* ===== セクション ===== */
    .content{
      width:min(980px, 92vw);
      margin: 0 auto;
      padding: 86px 0 72px;
    }
    .content h2{
      margin:0 0 14px;
      letter-spacing:.12em;
      text-shadow: 0 10px 26px rgba(0,0,0,.6);
    }
    .content p{ margin:0; line-height:1.9; opacity:.90; }

    .pagehead{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; flex-wrap:wrap; margin: 0 0 12px;
    }
    .badge{
      display:inline-block;
      padding:6px 10px;
      border:1px solid rgba(255,90,210,.22);
      border-radius:999px;
      background: rgba(0,0,0,.28);
      opacity:.88;
      letter-spacing:.08em;
      font-size:12px;
    }
    .panel{
      border:1px solid var(--line);
      border-radius:18px;
      background: linear-gradient(to bottom, rgba(0,0,0,.50), rgba(0,0,0,.20));
      backdrop-filter: blur(6px);
      padding:16px;
      box-shadow: 0 10px 40px rgba(0,0,0,.30);
    }

    /* ===== アルバム（1枚だけ中央で大きく） ===== */
    .grid{
      display:grid;
      grid-template-columns: minmax(0, 1fr);
      gap:14px;
      margin-top:16px;
    }
    .card{
      border:1px solid var(--line);
      border-radius:18px;
      background: linear-gradient(to bottom, rgba(0,0,0,.48), rgba(0,0,0,.22));
      backdrop-filter: blur(6px);
      padding:16px;
      cursor:pointer;
      user-select:none;
      box-shadow: 0 10px 40px rgba(0,0,0,.35);
      transition: transform .18s ease, background .18s ease;
      min-height:140px;
      display:flex; flex-direction:column; justify-content:space-between;
      max-width:720px;
      margin: 0 auto;
    }
    .card:hover{ transform: translateY(-2px); background: linear-gradient(to bottom, rgba(0,0,0,.58), rgba(0,0,0,.22)); }
    .card .title{ font-weight:800; letter-spacing:.08em; }
    .card .desc{ opacity:.78; margin-top:8px; line-height:1.7; }

    /* ===== SOUNDS ===== */
    .player{ display:grid; grid-template-columns: 1fr; gap:14px; }
    .nowplaying{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px; flex-wrap:wrap;
    }
    .nowtitle{ font-weight:800; letter-spacing:.06em; opacity:.95; }
    .audio{
      width:100%;
      filter: drop-shadow(0 10px 25px rgba(0,0,0,.55));
      opacity:.96;
    }
    .plist{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:10px;
    }
    .trackbtn{
      text-align:left;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.25);
      color:var(--text);
      cursor:pointer;
      letter-spacing:.04em;
      opacity:.9;
    }
    .trackbtn:hover{ background: rgba(0,0,0,.45); opacity:1; }
    .trackbtn.active{
      border-color: rgba(255,90,210,.28);
      background: rgba(0,0,0,.55);
      opacity:1;
    }
    .tiny{ opacity:.72; font-size:12px; letter-spacing:.06em; }

    .footer{ width:min(980px, 92vw); margin: 0 auto; padding: 30px 0 70px; opacity:.72; }

    /* ===== モーダル（3択） ===== */
    .modal-backdrop{
      position:fixed; inset:0;
      background: rgba(0,0,0,.62);
      backdrop-filter: blur(6px);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:100;
      padding: 24px 14px;
    }
    .modal-backdrop.show{ display:flex; }
    .modal{
      width:min(760px, 94vw);
      border-radius:20px;
      border:1px solid var(--line);
      background: linear-gradient(to bottom, rgba(0,0,0,.72), rgba(0,0,0,.32));
      box-shadow: 0 20px 80px rgba(0,0,0,.65);
      padding:18px;
      position:relative;
    }
    .modal h3{ margin:6px 0 4px; letter-spacing:.10em; }
    .modal p{ margin:0 0 12px; opacity:.80; line-height:1.8; }
    .row3{ margin-top:12px; display:grid; gap: 10px; }
    .close{
      position:absolute; top:10px; right:10px;
      width:40px; height:40px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.35);
      color:var(--text);
      cursor:pointer;
    }
    .close:hover{ background: rgba(0,0,0,.55); }

    @media (max-width: 560px){
      .menu{ display:none; }
      .brand{ font-size:14px; }
      .hero{ padding-top: 72px; }
      .plist{ grid-template-columns: 1fr; }
    }
    @media (prefers-reduced-motion: reduce){
      .chains, .smoke, .logo, .logo-wrap, .logo-wrap::before, .logo-wrap::after{ animation:none !important; }
      canvas#embers{ display:none; }
    }
  </style>
</head>

<body>
  <header class="nav">
    <div class="brand">縫魔 妖斗 <small>Official</small></div>
    <nav class="menu">
      <a href="#top">TOP</a>
      <a href="#profile">PROFILE</a>
      <a href="#album">ALBUM</a>
      <a href="#sounds">SOUNDS</a>
      <a href="#games">GAMES</a>
      <a href="#artists">ARTISTS</a>
    </nav>
  </header>

  <main class="stage" id="top">
    <div class="bg" id="bg"></div>
    <div class="chains" id="chains"></div>
    <canvas id="embers"></canvas>
    <div class="smoke s1"></div>
    <div class="smoke s2"></div>
    <div class="smoke s3"></div>
    <div class="vignette"></div>

    <section class="hero">
      <div class="hero-panel">
        <span class="logo-wrap" data-text="縫魔 妖斗">
          <h1 class="logo">縫魔 妖斗</h1>
        </span>
        <span class="stitchline"></span>
        <p class="tag">縫牢街で、存在は作品になる。</p>
        <a class="btn" href="#album">ENTER</a>
      </div>
    </section>

    <!-- PROFILE -->
    <section class="content" id="profile">
      <div class="pagehead">
        <h2>縫魔妖斗とは【プロフィール】</h2>
        <span class="badge">PROFILE</span>
      </div>

      <div class="panel">
        <p style="margin:0; line-height:1.9; opacity:.92;">
          <b>名前：</b> 縫魔 妖斗（ぬいま あやと）<br>
          <b>活動：</b> AIと一緒に、音源やゲームを作ったりしてます。<br>
          <b>縫牢街（ほうろうがい）：</b> そこで存在を縫い直してる。そして作品が出来てくる。
        </p>

        <div style="margin-top:14px; border-top:1px solid rgba(255,255,255,.10); padding-top:12px;">
          <div style="display:grid; gap:10px;">
            <div style="border:1px solid rgba(255,255,255,.10); border-radius:14px; padding:12px; background:rgba(0,0,0,.22);">
              <b>好きな音楽</b>
              <p style="margin:6px 0 0; opacity:.9; line-height:1.8;">
                メロディーが心に残る物。基本Allジャンル。
              </p>
            </div>

            <div style="border:1px solid rgba(255,255,255,.10); border-radius:14px; padding:12px; background:rgba(0,0,0,.22);">
              <b>好きなゲーム</b>
              <p style="margin:6px 0 0; opacity:.9; line-height:1.8;">
                ロックマン／龍が如くシリーズ／ほか色々。
              </p>
            </div>

            <p class="tiny" style="margin:0;">
              ※縫牢街の設定は随時アップデートOK（街のルール、住人、禁忌、通貨など）
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- ALBUM（1枚のみ） -->
    <section class="content" id="album">
      <div class="pagehead">
        <h2>縫魔が作り上げてきた世界観【アルバム】</h2>
        <span class="badge">ALBUM</span>
      </div>

      <div class="grid" id="albumGrid">
        <div class="card" data-album="0">
          <div>
            <div class="title">ALBUM 01：Neon Stitch</div>
            <div class="desc">紫とピンクの夜。縫い糸が走る路地裏。</div>
          </div>
        </div>
      </div>
    </section>

    <!-- SOUNDS -->
    <section class="content" id="sounds">
      <div class="pagehead">
        <h2>縫牢街の楽曲達</h2>
        <span class="badge">SOUNDS</span>
      </div>

      <p style="margin:0 0 12px; opacity:.9; line-height:1.9;">
        聴いてみたい音源を押して下さい（上のプレイヤーで再生されます）。<br>
        ※端末によっては再生ボタン（▶）を押す必要があります。
      </p>

      <div class="panel player">
        <div class="nowplaying">
          <div>
            <div class="nowtitle" id="nowTitle">未選択</div>
            <div class="tiny" id="audioMsg">※曲を押すと読み込み→再生</div>
          </div>
          <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <button class="btn ghost" id="prevBtn" type="button">◀ PREV</button>
            <button class="btn ghost" id="nextBtn" type="button">NEXT ▶</button>
          </div>
        </div>

        <audio class="audio" id="audio" controls preload="metadata"></audio>
        <div class="plist" id="plist"></div>
      </div>

      <div style="margin-top:14px;">
        <a class="btn ghost" href="#album">← アルバムへ戻る</a>
      </div>
    </section>

    <!-- GAMES -->
    <section class="content" id="games">
      <div class="pagehead">
        <h2>縫牢街のゲームセンター</h2>
        <span class="badge">GAMES</span>
      </div>

      <div class="panel">
        <p>同じフォルダ内のゲームを起動する。</p>

        <div style="margin-top:12px; display:flex; gap:12px; flex-wrap:wrap;">
          <a class="btn" href="./リアビュー１/index.html">リアビュー１</a>
          <a class="btn" href="./リアビュー２/index.html">リアビュー２</a>
        </div>

        <p class="tiny" style="margin-top:10px;">
          ※各フォルダの中に index.html が必要（リアビュー１ / リアビュー２）
        </p>

        <div style="margin-top:14px; border-top:1px solid rgba(255,255,255,.10); padding-top:12px;">
          <div class="pagehead" style="margin:0 0 10px;">
            <h3 style="margin:0; letter-spacing:.10em;">操作方法</h3>
            <span class="badge">HOW TO PLAY</span>
          </div>

          <div style="display:grid; gap:10px;">
            <div style="border:1px solid rgba(255,255,255,.10); border-radius:14px; padding:12px; background:rgba(0,0,0,.22);">
              <b>リアビュー１：追跡ホラーラン</b>
              <p style="margin:6px 0 10px; opacity:.9; line-height:1.8;">
                追いかけてくる幽霊から逃げる。障害物を避けながら、目的地まで逃げ切れ。
              </p>
              <ul style="margin:0; padding-left:18px; line-height:1.9; opacity:.92;">
                <li><b>A：</b> 左移動</li>
                <li><b>D：</b> 右移動</li>
                <li><b>Space：</b> 走る</li>
              </ul>
            </div>

            <div style="border:1px solid rgba(255,255,255,.10); border-radius:14px; padding:12px; background:rgba(0,0,0,.22);">
              <b>リアビュー２：予告回避サバイバル</b>
              <p style="margin:6px 0 10px; opacity:.9; line-height:1.8;">
                都市伝説の攻撃を、目的地に着くまでひたすら回避。<br>
                攻撃予告が出るので、それを元に攻撃範囲から避けて下さい。
              </p>
              <ul style="margin:0; padding-left:18px; line-height:1.9; opacity:.92;">
                <li><b>W：</b> 上</li>
                <li><b>A：</b> 左</li>
                <li><b>D：</b> 右</li>
                <li><b>S：</b> 下</li>
              </ul>
            </div>

            <p class="tiny" style="margin:0;">
              ※推奨：横画面 / 音量ON。スマホはキーボード操作が難しいためPC推奨。
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- ARTISTS -->
    <section class="content" id="artists">
      <div class="pagehead">
        <h2>縫牢街で有名なアーティスト達</h2>
        <span class="badge">ARTISTS</span>
      </div>
      <div class="panel">
        <p>ここは「縫牢街の名鑑」。後でカード化して詳細ページにもできる。</p>
        <ul style="margin:10px 0 0; padding-left:18px; opacity:.9; line-height:1.9;">
          <li>夜梵（YA-BON）</li>
          <li>NEX3</li>
          <li>ミカヅキ（Mika &amp; Zuki）</li>
          <li>ウホッとコング / ゴルラック</li>
          <li>…ほか（追加OK）</li>
        </ul>
      </div>
    </section>

    <footer class="footer">
      <small>© Nuima Ayato</small>
    </footer>
  </main>

  <!-- モーダル（3択） -->
  <div class="modal-backdrop" id="modal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <button class="close" id="modalClose" aria-label="閉じる">×</button>
      <h3 id="modalTitle">ALBUM MENU</h3>
      <p id="modalDesc">どこへ移動する？</p>
      <div class="row3">
        <button class="btn danger" data-go="#sounds">縫牢街の楽曲達</button>
        <button class="btn danger" data-go="#games">縫牢街のゲームセンター</button>
        <button class="btn danger" data-go="#artists">縫牢街で有名なアーティスト達</button>
      </div>
      <div style="margin-top:14px; display:flex; justify-content:flex-end; gap:10px; flex-wrap:wrap;">
        <button class="btn ghost" id="stayAlbum">キャンセル</button>
      </div>
    </div>
  </div>

  <script>
    /* ========= 1) パララックス ========= */
    const bg = document.getElementById("bg");
    const chains = document.getElementById("chains");
    let cx = 0, cy = 0;

    window.addEventListener("mousemove", (e) => {
      cx = (e.clientX / window.innerWidth) - 0.5;
      cy = (e.clientY / window.innerHeight) - 0.5;
    }, { passive: true });

    (function parallaxTick(){
      bg.style.transform = `translate3d(${cx * -8}px, ${cy * -6}px, 0) scale(1.03)`;
      chains.style.transform = `translate3d(${cx * -16}px, ${cy * -12}px, 0) scale(1.08)`;
      requestAnimationFrame(parallaxTick);
    })();

    /* ========= 2) スクロールで煙 ========= */
    const root = document.documentElement;
    const clamp = (n,a,b)=>Math.min(b,Math.max(a,n));
    function updateSmokeByScroll(){
      const doc = document.documentElement;
      const max = (doc.scrollHeight - doc.clientHeight) || 1;
      const t = clamp(window.scrollY / max, 0, 1);
      root.style.setProperty("--smoke-a", (0.88 - t * 0.45).toFixed(3));
      root.style.setProperty("--smoke-b", (0.58 - t * 0.33).toFixed(3));
      root.style.setProperty("--smoke-c", (0.38 - t * 0.22).toFixed(3));
    }
    updateSmokeByScroll();
    window.addEventListener("scroll", updateSmokeByScroll, { passive:true });
    window.addEventListener("resize", updateSmokeByScroll, { passive:true });

    /* ========= 3) 火の粉 ========= */
    const canvas = document.getElementById("embers");
    const ctx = canvas.getContext("2d", { alpha: true });
    let W = 0, H = 0;

    function resize(){
      const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      W = Math.floor(window.innerWidth);
      H = Math.floor(window.innerHeight);
      canvas.width  = Math.floor(W * dpr);
      canvas.height = Math.floor(H * dpr);
      canvas.style.width = W + "px";
      canvas.style.height = H + "px";
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }
    resize();
    window.addEventListener("resize", resize, { passive:true });

    const rand=(a,b)=>a+Math.random()*(b-a);
    const embers = [];
    function particleCount(){
      const area = W * H;
      return Math.max(18, Math.min(55, Math.floor(area / 42000)));
    }
    function spawn(){
      embers.length = 0;
      for(let i=0;i<particleCount();i++){
        embers.push({
          x: rand(0, W),
          y: rand(0, H),
          r: rand(0.7, 2.2),
          vx: rand(-0.12, 0.12),
          vy: rand(-0.55, -0.15),
          a: rand(0.25, 0.85),
          life: rand(80, 220),
          hue: rand(290, 340),
        });
      }
    }
    spawn();

    let last = performance.now();
    function emberTick(now){
      const dt = Math.min(33, now - last);
      last = now;
      ctx.clearRect(0,0,W,H);
      const wind = cx * 0.35;

      for(const p of embers){
        p.x += (p.vx + wind) * dt * 0.6;
        p.y += p.vy * dt * 0.6;
        p.life -= dt * 0.8;

        if(p.y < -10 || p.life <= 0){
          p.x = rand(0, W);
          p.y = H + rand(0, 80);
          p.r = rand(0.7, 2.2);
          p.vx = rand(-0.12, 0.12);
          p.vy = rand(-0.55, -0.15);
          p.a = rand(0.25, 0.85);
          p.life = rand(80, 220);
          p.hue = rand(290, 340);
        }
        if(p.x < -20) p.x = W + 20;
        if(p.x > W + 20) p.x = -20;

        ctx.beginPath();
        ctx.fillStyle = `hsla(${p.hue}, 95%, 65%, ${p.a})`;
        ctx.shadowColor = `hsla(${p.hue}, 95%, 65%, ${p.a})`;
        ctx.shadowBlur = 10;
        ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
        ctx.fill();
      }
      ctx.shadowBlur = 0;
      requestAnimationFrame(emberTick);
    }
    requestAnimationFrame(emberTick);

    document.addEventListener("visibilitychange", () => {
      if(document.hidden){
        embers.length = Math.max(8, Math.floor(embers.length * 0.35));
      }else{
        spawn();
      }
    });

    /* ========= 4) アルバム→3択モーダル（1枚でもOK） ========= */
    const modal = document.getElementById("modal");
    const modalClose = document.getElementById("modalClose");
    const stayAlbum = document.getElementById("stayAlbum");
    const modalDesc = document.getElementById("modalDesc");
    const albumGrid = document.getElementById("albumGrid");

    const ALBUMS = [
      { title:"ALBUM 01：Neon Stitch", desc:"紫とピンクの夜。縫い糸が走る路地裏。" },
    ];

    function openModal(albumIndex){
      const a = ALBUMS[albumIndex] || { title:"ALBUM", desc:"" };
      modalDesc.textContent = `${a.title} / ${a.desc}  → どこへ移動する？`;
      modal.classList.add("show");
      document.body.style.overflow = "hidden";
    }
    function closeModal(){
      modal.classList.remove("show");
      document.body.style.overflow = "";
    }

    albumGrid.addEventListener("click", (e) => {
      const card = e.target.closest(".card");
      if(!card) return;
      openModal(0);
    });

    modal.addEventListener("click", (e) => { if(e.target === modal) closeModal(); });
    modalClose.addEventListener("click", closeModal);
    stayAlbum.addEventListener("click", closeModal);
    window.addEventListener("keydown", (e) => {
      if(e.key === "Escape" && modal.classList.contains("show")) closeModal();
    });

    modal.querySelectorAll("[data-go]").forEach(btn => {
      btn.addEventListener("click", () => {
        const to = btn.getAttribute("data-go");
        closeModal();
        setTimeout(() => {
          history.pushState(null, "", to);
          document.querySelector(to)?.scrollIntoView({ behavior:"smooth", block:"start" });
        }, 80);
      });
    });

    document.querySelectorAll('a[href^="#"]').forEach(a=>{
      a.addEventListener("click", (e)=>{
        const href = a.getAttribute("href");
        if(!href || href === "#") return;
        const el = document.querySelector(href);
        if(!el) return;
        e.preventDefault();
        history.pushState(null, "", href);
        el.scrollIntoView({ behavior:"smooth", block:"start" });
      });
    });

    /* ========= 5) SOUNDS（track01だけ直置き / それ以外は music/） ========= */
    const AUDIO_DIR = "music/";
    const TRACKS = [
      { title:"Track 01", file:"track01.mp3" },
      { title:"Track 02", file:AUDIO_DIR+"track02.mp3" },
      { title:"Track 03", file:AUDIO_DIR+"track03.mp3" },
      { title:"Track 04", file:AUDIO_DIR+"track04.mp3" },
      { title:"Track 05", file:AUDIO_DIR+"track05.mp3" },
      { title:"Track 06", file:AUDIO_DIR+"track06.mp3" },
      { title:"Track 07", file:AUDIO_DIR+"track07.mp3" },
      { title:"Track 08", file:AUDIO_DIR+"track08.mp3" },
      { title:"Track 09", file:AUDIO_DIR+"track09.mp3" },
      { title:"Track 10", file:AUDIO_DIR+"track10.mp3" },
      { title:"Track 11", file:AUDIO_DIR+"track11.mp3" },
      { title:"Track 12", file:AUDIO_DIR+"track12.mp3" },
      { title:"Track 13", file:AUDIO_DIR+"track13.mp3" },
      { title:"Track 14", file:AUDIO_DIR+"track14.mp3" },
      { title:"Track 15", file:AUDIO_DIR+"track15.mp3" },
      { title:"Track 16", file:AUDIO_DIR+"track16.mp3" },
      { title:"Track 17", file:AUDIO_DIR+"track17.mp3" },
      { title:"Track 18", file:AUDIO_DIR+"track18.mp3" },
      { title:"Track 19", file:AUDIO_DIR+"track19.mp3" },
      { title:"Track 20", file:AUDIO_DIR+"track２０.mp3" }, // 全角２０
    ];

    const plist = document.getElementById("plist");
    const audio = document.getElementById("audio");
    const nowTitle = document.getElementById("nowTitle");
    const audioMsg = document.getElementById("audioMsg");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    let currentIndex = -1;

    function setActiveButton(){
      [...plist.querySelectorAll(".trackbtn")].forEach((b, i) => {
        b.classList.toggle("active", i === currentIndex);
      });
    }

    function loadTrack(i, autoplay=true){
      if(i < 0) i = TRACKS.length - 1;
      if(i >= TRACKS.length) i = 0;
      currentIndex = i;

      const t = TRACKS[i];
      nowTitle.textContent = `${t.title} / ${t.file}`;
      audioMsg.textContent = "読み込み中…";
      audio.src = t.file;
      audio.load();
      setActiveButton();

      if(autoplay){
        audio.play().catch(()=>{});
      }
    }

    function buildPlaylist(){
      plist.innerHTML = "";
      TRACKS.forEach((t, i) => {
        const b = document.createElement("button");
        b.type = "button";
        b.className = "trackbtn";
        b.textContent = t.title;
        b.addEventListener("click", () => loadTrack(i, true));
        plist.appendChild(b);
      });
    }
    buildPlaylist();

    prevBtn.addEventListener("click", () => loadTrack(currentIndex - 1, true));
    nextBtn.addEventListener("click", () => loadTrack(currentIndex + 1, true));
    audio.addEventListener("ended", () => loadTrack(currentIndex + 1, true));

    audio.addEventListener("loadedmetadata", () => {
      const d = audio.duration;
      if(Number.isFinite(d) && d > 0){
        audioMsg.textContent = `読み込みOK：${Math.floor(d)}秒`;
      }else{
        audioMsg.textContent = "読み込みはしたけど長さ取得できない（形式/制限の可能性）";
      }
    });

    audio.addEventListener("error", () => {
      audioMsg.textContent = "読み込み失敗：ファイル名/場所を確認（track01は直置き、他はmusic/）";
    });
  </script>
</body>
</html>